{"version":3,"sources":["app/initialize.js","app/map_util.js","app/models/polygon.js","app/models/territory.js","app/views/map_view.js","app/views/search_view.js","app/views/territory_view.js"],"names":["document","addEventListener","window","searchView","SearchView","territoryView","TerritoryView","mapView","MapView","$","keydown","evt","which","cmdPressed","keyup","gmapifyPoints","points","point","google","maps","LatLng","gmapifyPolygons","polygons","poly","c","gon","i","innerCoords","len","outerCoords","purgeLonePoints","coords","push","length","Polygon","territory","originalCoords","originalCenter","getCenter","accumulatedLatDiff","accumulatedLngDiff","e","startingLat","latLng","lat","startingLng","lng","gmapPolygon","getPaths","getArray","map","j","movePolygons","createGmapPolygon","event","addListener","dragStart","bind","dragEnd","clearInstanceListeners","setMap","removeFromMap","addToMap","bounds","LatLngBounds","forEach","p","extend","paths","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","draggable","geodesic","latDiff","lngDiff","move","Territory","attrs","Object","assign","id","getId","type","abbrev","terse","join","reset","remove","polygon","name","state","toUpperCase","country","polygon_center","map_center","root","url","getURL","getJSON","success","resp","addTerritory","error","err","allTerritories","t","territories","bringtoCenter","setCenter","zoom","setZoom","addPolygons","ele","dropdownMenu","find","input","on","onInput","onKeydown","onFocus","clickDropdownItem","places","countries","filter","states","cities","click","target","closest","removeClass","classList","add","val","setTimeout","closeDropdown","findById","getAttribute","fetchPoints","addItem","currentTarget","addClass","value","openDropdown","dir","active","children","index","last","first","item","moveSelection","goDown","goUp","hitEnter","hitEsc","matches","findMatches","innerHTML","renderDropdownHtml","html","friendlyName","badgeClass","query","RegExp","replace","some","thing","things","test","territoryDiv","clickTerritory","preventDefault","attr","hasClass","resetTerritory","gotoTerritory","dropdown","removeTerritory","renderTerritory","append"],"mappings":"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","file":"public/app.js","sourcesContent":["import Territory from 'models/territory.js';\nimport SearchView from 'views/search_view.js';\nimport TerritoryView from 'views/territory_view.js';\nimport MapView from 'views/map_view.js';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  // do your setup here\n  // console.log('Initialized app');\n\n  window.searchView = new SearchView;\n  window.territoryView = new TerritoryView;\n  window.mapView = new MapView;\n});\n\n$(window).keydown(function(evt) {\n  if (evt.which == 91) { // cmd\n    window.cmdPressed = true;\n  }\n}).keyup(function(evt) {\n  if (evt.which == 91) { // cmd\n    window.cmdPressed = false;\n  }\n});\n","import reject from 'lodash/reject';\nimport map from 'lodash/map';\n\nvar gmapifyPoints = function(points) {\n  return map(points, function(point) {\n    return new google.maps.LatLng(point[1], point[0]);\n  });\n};\n\nexport const gmapifyPolygons = function(polygons) {\n  return map(polygons, function(poly) {\n    var c, gon, i, innerCoords, len, outerCoords;\n    gon = [];\n    outerCoords = gmapifyPoints(purgeLonePoints(poly.outerCoords));\n    innerCoords = map(poly.innerCoords, function(coords) {\n      return gmapifyPoints(purgeLonePoints(coords));\n    });\n    gon.push(outerCoords);\n    for (i = 0, len = innerCoords.length; i < len; i++) {\n      c = innerCoords[i];\n      gon.push(c);\n    }\n    return gon;\n  });\n};\n\nvar purgeLonePoints = function(coords) {\n  return reject(coords, function(point) {\n    return point.length < 2;\n  });\n};\n","import map from 'lodash/map';\nimport reject from 'lodash/reject';\n\nclass Polygon {\n  constructor(coords, territory) {\n    this.territory = territory;\n    this.originalCoords = this.coords = coords;\n    this.originalCenter = this.getCenter()\n    this.accumulatedLatDiff = 0\n    this.accumulatedLngDiff = 0\n  }\n\n  dragStart(e) {\n    this.startingLat = e.latLng.lat()\n    this.startingLng = e.latLng.lng()\n  }\n\n  dragEnd(e) {\n    this.accumulatedLatDiff += (this.startingLat - e.latLng.lat())\n    this.accumulatedLngDiff += (this.startingLng - e.latLng.lng())\n\n    this.coords = this.gmapPolygon.getPaths().getArray().map(c => c.getArray().map(j => j))\n\n    if (window.cmdPressed) {\n      this.movePolygons(this.accumulatedLatDiff, this.accumulatedLngDiff);\n    }\n  }\n\n  addToMap() {\n    this.createGmapPolygon();\n\n    google.maps.event.addListener(this.gmapPolygon, 'dragstart', this.dragStart.bind(this));\n    google.maps.event.addListener(this.gmapPolygon, 'dragend', this.dragEnd.bind(this));\n  }\n\n  removeFromMap() {\n    google.maps.event.clearInstanceListeners(this.gmapPolygon);\n    this.gmapPolygon.setMap(null);\n  }\n\n  reset() {\n    this.accumulatedLatDiff = 0\n    this.accumulatedLngDiff = 0\n    this.coords = this.originalCoords\n    this.removeFromMap()\n    this.addToMap()\n  }\n\n  remove() {\n    this.removeFromMap();\n    //this.territory.polygons = reject(this.territory.polygons, p => p === this);\n  }\n\n  getCenter() {\n    let bounds = new google.maps.LatLngBounds()\n    let points = this.originalCoords[0]\n\n    points.forEach((p) => {\n      bounds.extend(p)\n    })\n\n    return bounds.getCenter()\n  }\n\n  createGmapPolygon() {\n    this.gmapPolygon = new google.maps.Polygon({\n      map: window.map,\n      paths: this.coords,\n      strokeColor: \"#FF0000\",\n      strokeOpacity: 0.8,\n      strokeWeight: 1,\n      fillColor: \"#FF0000\",\n      fillOpacity: 0.35,\n      draggable: true,\n      geodesic: true\n    })\n  }\n\n  move(latDiff, lngDiff) {\n    this.removeFromMap()\n\n    this.accumulatedLatDiff = latDiff\n    this.accumulatedLngDiff = lngDiff\n\n    this.coords = map(this.originalCoords, (coords) => {\n      return map(coords, (c) => {\n        return new google.maps.LatLng(c.lat() - latDiff, c.lng() - lngDiff)\n      });\n    })\n\n    this.addToMap();\n  }\n\n  movePolygons(latDiff, lngDiff) {\n    this.territory.polygons.forEach((p) => {\n      if (p === this) return\n\n      p.move(latDiff, lngDiff)\n    })\n  }\n}\n\nexport default Polygon;\n","import find from 'lodash/find';\nimport map from 'lodash/map';\nimport Polygon from 'models/polygon.js';\n\nimport {gmapifyPolygons} from './../map_util.js';\n\nclass Territory {\n  constructor(attrs) {\n    this.polygons = [];\n\n    Object.assign(this, attrs);\n    this.id = this.getId()\n  }\n\n  getId() {\n    return [this.type, this.abbrev || this.terse].join('-')\n  }\n\n  reset() {\n    this.polygons.forEach(p => p.reset())\n  }\n\n  remove() {\n    this.polygons.forEach(p => p.remove())\n  }\n\n  addPolygon(polygon) {\n    this.polygons.push(polygon)\n  }\n\n  friendlyName() {\n    let name = this.name;\n\n    if (this.type == 'city') {\n      name = name + ` (${this.state.toUpperCase()})`\n    } else if (this.type == 'state') {\n      name = name + ` (${this.country.toUpperCase()})`\n    }\n\n    return name;\n  }\n\n  bringtoCenter() {\n    let polygon_center = this.polygons[0].getCenter();\n    let map_center = window.map.getCenter()\n    let latDiff = polygon_center.lat() - map_center.lat()\n    let lngDiff = polygon_center.lng() - map_center.lng()\n\n    this.polygons.forEach((p) => {\n      p.move(latDiff, lngDiff);\n    });\n  }\n\n  badgeClass() {\n    switch(this.type) {\n      case 'city': return 'info'\n      case 'state': return 'light'\n      case 'country': return 'dark'\n    }\n  }\n\n  static findById(id) {\n    return find(window.allTerritories, t => t.id == id)\n  }\n\n  getURL() {\n    const root = 'https://s3-us-west-2.amazonaws.com/yodap'\n    var url;\n\n    if (this.type == 'country') {\n      url = `${root}/countries/${this.abbrev}.json`\n    } else if (this.type == 'state') {\n      url = `${root}/states/${this.abbrev}.json`\n    } else if (this.type == 'city') {\n      url = `${root}/cities/${this.country}/${this.state}/${this.terse}.json`\n    }\n\n    return url;\n  }\n\n  getCenter() {\n    let polygon = this.polygons[0];\n    return polygon.getCenter();\n  }\n\n  addPolygons() {\n    this.polygons.forEach(p => p.addToMap())\n  }\n\n  fetchPoints() {\n    let url = this.getURL();\n\n    $.getJSON({\n      url: url,\n      success: (resp) => {\n        let coords = gmapifyPolygons(resp.polygons);\n        let polygons = map(coords, c => new Polygon(c, this))\n        this.polygons = polygons;\n        window.mapView.addTerritory(this);\n      },\n      error: (err) => {\n      }\n    });\n  }\n}\n\nexport default Territory;\n","import Polygon from 'models/polygon.js';\n\nclass MapView {\n  constructor() {\n    this.territories = [];\n  }\n\n  resetTerritory(t) {\n    t.reset();\n  }\n\n  bringtoCenter(t) {\n    t.bringtoCenter();\n  }\n\n  gotoTerritory(t) {\n    window.map.setCenter(t.getCenter())\n\n    var zoom;\n    switch (t.type) {\n      case 'city':\n        zoom = 10;\n        break;\n      case 'state':\n        zoom = 5;\n        break;\n      case 'country':\n        zoom = 4;\n        break;\n    }\n\n    window.map.setZoom(zoom)\n  }\n\n  removeTerritory(t) {\n    t.remove()\n  }\n\n  addTerritory(t) {\n    t.addPolygons()\n  }\n}\n\nexport default MapView;\n","import Territory from '../models/territory.js';\nimport flatten from 'lodash/flatten';\n\n// import flatten from '../../node_modules/lodash/flatten.js';\n// import map from '../../node_modules/lodash/map.js';\n\nclass SearchView {\n  constructor() {\n    this.ele = $('#search-hold');\n    this.dropdownMenu = this.ele.find('.dropdown-menu');\n\n    let input = $('#search-input');\n    input.on('input', this.onInput.bind(this));\n    input.on('keydown', this.onKeydown.bind(this));\n    input.on('focus', this.onFocus.bind(this));\n    this.dropdownMenu.on('click', 'a.dropdown-item', this.clickDropdownItem.bind(this))\n\n    $.getJSON({\n      url: 'https://s3-us-west-2.amazonaws.com/yodap/places.json.gz',\n      success: function(places) {\n        window.countries = places.filter(p => p.type == 'country').map(p => new Territory(p));\n        window.states = places.filter(p => p.type == 'state').map(p => new Territory(p));\n        window.cities = places.filter(p => p.type == 'city').map(p => new Territory(p));\n        window.allTerritories = flatten([countries, states, cities]);\n      }.bind(this)\n    })\n\n    $(document).click((event) => {\n      if(!$(event.target).closest('#search-dropdown-hold').length) {\n        this.dropdownMenu.removeClass('show');\n      }\n    });\n  }\n\n  addItem(ele) {\n    ele.classList.add('active')\n    $('#search-input').val('')\n    setTimeout(() => this.closeDropdown(), 5)\n\n    let t = Territory.findById(ele.getAttribute('data-id'))\n    t.fetchPoints();\n    window.territoryView.addTerritory(t)\n  }\n\n  clickDropdownItem(e) {\n    this.dropdownMenu.find('a.active').removeClass('active')\n    this.addItem(e.currentTarget)\n  }\n\n  openDropdown() {\n    this.dropdownMenu.addClass('show')\n  }\n\n  closeDropdown() {\n    this.dropdownMenu.removeClass('show')\n  }\n\n  onFocus(e) {\n    if (e.currentTarget.value.length) {\n      this.openDropdown()\n    }\n  }\n\n  moveSelection(dir) {\n    let active = this.dropdownMenu.find('.active')[0];\n    let children = this.dropdownMenu.children();\n\n    let index = active ? children.index(active) : -1;\n\n    let ele = children[index + dir];\n\n    if (!ele) {\n      ele = dir == -1 ? children.last()[0] : children.first()[0]\n    }\n\n    children.removeClass('active')\n\n    if (ele) {\n      ele.classList.add('active')\n    }\n  }\n\n  hitEnter() {\n    let item;\n    if (item = this.dropdownMenu.find('.active')[0]) {\n      this.addItem(item);\n    }\n  }\n\n  hitEsc() {\n    this.closeDropdown()\n  }\n\n  goUp() { this.moveSelection(-1) }\n  goDown() { this.moveSelection(1) }\n\n  onKeydown(e) {\n    if (e.which == 40) {\n      this.goDown();\n    } else if (e.which == 38) {\n      this.goUp();\n    } else if (e.which == 13) {\n      this.hitEnter()\n    } else if (e.which == 27) {\n      this.hitEsc();\n    }\n  }\n\n  onInput(e) {\n    let val = e.currentTarget.value;\n    let matches = this.findMatches(val);\n\n    if (matches.length) {\n      this.dropdownMenu[0].innerHTML = this.renderDropdownHtml(matches);\n      this.openDropdown()\n    } else {\n      this.closeDropdown()\n    }\n  }\n\n  renderDropdownHtml(matches) {\n    let html = []\n\n    matches.forEach((t) => {\n      html.push(`\n        <a class='dropdown-item' data-id='${t.id}' href='#'>\n          ${t.friendlyName()}\n          <span class=\"badge badge-${t.badgeClass()}\">${t.type}</span>\n        </a>\n      `)\n    })\n\n    return html.join('')\n  }\n\n  findMatches(query) {\n    if (query.length > 2) {\n      query = new RegExp(query.replace(/\\s|\\(|\\)/, ''), \"i\")\n    } else {\n      query = new RegExp('^' + query.replace(/\\s|\\(|\\)/, ''), \"i\")\n    }\n\n    let matches = [];\n\n    ['countries', 'states', 'cities'].some((thing) => {\n      let things = window[thing];\n\n      return things.some((t) => {\n        if (query.test(t.terse)) {\n          matches.push(t)\n        }\n\n        return matches.length >= 20;\n      })\n    })\n\n    return matches;\n  }\n}\n\nexport default SearchView;\n","import Territory from '../models/territory.js';\n// import map from '../../node_modules/lodash/map.js';\n\nclass TerritoryView {\n  constructor() {\n    this.territoryDiv = $('#territory-hold');\n    this.territoryDiv.on('click', 'a.dropdown-item', this.clickTerritory.bind(this))\n  }\n\n  clickTerritory(e) {\n    e.preventDefault();\n\n    let t = $(e.currentTarget);\n    let id = t.closest('.dropdown').attr('data-id');\n    let territory = Territory.findById(id);\n\n    if (t.hasClass('reset')) {\n      window.mapView.resetTerritory(territory);\n    } else if (t.hasClass('goto')) {\n      window.mapView.gotoTerritory(territory);\n    } else if (t.hasClass('bringtocenter')) {\n      window.mapView.bringtoCenter(territory);\n    } else if (t.hasClass('remove')) {\n      let dropdown = this.territoryDiv.find(`div.dropdown[data-id=\"${territory.id}\"]`);\n      dropdown.remove();\n\n      window.mapView.removeTerritory(territory);\n    }\n  }\n\n  addTerritory(t) {\n    let html = this.renderTerritory(t);\n    this.territoryDiv.append(html);\n  }\n\n  renderTerritory(t) {\n    return `\n      <div class=\"dropdown pl-2\" data-id='${t.id}'>\n        <button class=\"btn btn-outline-secondary dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\">\n          ${t.name}\n        </button>\n        <div class=\"dropdown-menu\">\n          <a class=\"dropdown-item reset\" href=\"#\">Reset</a>\n          <a class=\"dropdown-item goto\" href=\"#\">Go to</a>\n          <a class=\"dropdown-item bringtocenter\" href=\"#\">Bring to center</a>\n          <div class=\"dropdown-divider\"></div>\n          <a class=\"dropdown-item remove\" href=\"#\">Remove</a>\n        </div>\n      </div>`\n  }\n}\n\nexport default TerritoryView;\n"]}